<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Carte – Août 1944</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    #map { height: 100vh; width: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([45.07, 5.8], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // Chargement brut du CSV
    fetch("data/victimes.csv?cb=" + Date.now())
      .then(r => r.text())
      .then(txt => {
        const lines = txt.trim().split("\n");
        const headers = lines[0].split(";");
        const data = lines.slice(1).map(line => {
          const cols = line.split(";");
          return {
            Commune: cols[0],
            Lieu: cols[1],
            Date: cols[2],
            Categorie: cols[3],
            Victimes: cols[4],
            Coordonnees: cols[5],
            Source: cols[6]
          };
        });

        console.log("Lignes lues :", data.length);

        data.forEach(row => {
          if (row.Coordonnees) {
            const [lat, lng] = row.Coordonnees.replace(/"/g,"").split(",").map(Number);
            if (!isNaN(lat) && !isNaN(lng)) {
              const popup = `
                <b>${row.Commune}</b><br>
                <i>${row.Lieu}</i><br>
                Date : ${row.Date}<br>
                Catégorie : ${row.Categorie}<br>
                Victimes : ${row.Victimes}<br>
                Source : ${row.Source}
              `;
              L.marker([lat, lng]).addTo(map).bindPopup(popup);
            } else {
              console.warn("Coordonnées invalides:", row.Coordonnees);
            }
          }
        });
      });
  </script>
</body>
</html>
