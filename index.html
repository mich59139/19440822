<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
<script>
  const map = L.map('map').setView([45.05, 5.82], 11);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  function getIcon(categorie) {
    if (categorie.toLowerCase().includes("ex√©cution") || categorie.toLowerCase().includes("victime")) {
      return L.icon({
        iconUrl: "https://cdn-icons-png.flaticon.com/512/1822/1822890.png", // ‚úùÔ∏è
        iconSize: [22, 22]
      });
    }
    if (categorie.toLowerCase().includes("combat")) {
      return L.icon({
        iconUrl: "https://cdn-icons-png.flaticon.com/512/1076/1076877.png", // ‚öîÔ∏è
        iconSize: [28, 28]
      });
    }
    return L.icon({
      iconUrl: "https://cdn-icons-png.flaticon.com/512/32/32339.png",
      iconSize: [20, 20]
    });
  }

  // Lecture du CSV
  Papa.parse("data/victimes.csv", {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      results.data.forEach(row => {
        if (!row.Coordonn√©es) return;
        const coords = row.Coordonn√©es.replace(/"/g, '').split(",");
        if (coords.length !== 2) return;

        const lat = parseFloat(coords[0]);
        const lng = parseFloat(coords[1]);
        if (isNaN(lat) || isNaN(lng)) return;

        const popup = `
          <b>${row.Commune}</b> ‚Äì ${row.Lieu}<br>
          üìÖ ${row.Date}<br>
          Cat√©gorie : ${row.Cat√©gorie}<br>
          Victimes : ${row.Victimes}<br>
          Source : ${row.Source || "N/A"}
        `;

        L.marker([lat, lng], { icon: getIcon(row.Cat√©gorie) })
          .addTo(map)
          .bindPopup(popup);
      });
    }
  });

  // L√©gende
  const legend = L.control({position: "bottomright"});
  legend.onAdd = function() {
    const div = L.DomUtil.create("div", "legend");
    div.innerHTML = `
      <b>L√©gende</b><br>
      <img src="https://cdn-icons-png.flaticon.com/512/1822/1822890.png" width="16"> Victimes / Ex√©cutions<br>
      <img src="https://cdn-icons-png.flaticon.com/512/1076/1076877.png" width="16"> Combats
    `;
    return div;
  };
  legend.addTo(map);
</script>
